<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pattern Image Converter</title>
    <link rel="stylesheet" href="/pattern/assets/css/pattern.css" />
    <script type="application/json" id="images-data">
      <%- JSON.stringify(data.availableImages || []) %>
    </script>
    <!-- Load JavaScript modules in order -->
    <script src="/pattern/assets/js/config.js"></script>
    <script src="/pattern/assets/js/helpers.js"></script>
    <script src="/pattern/assets/js/patternManager.js"></script>
    <script src="/pattern/assets/js/uiManager.js"></script>
    <script src="/pattern/assets/js/exportHandler.js"></script>
    <script src="/pattern/assets/js/uploadHandler.js"></script>
    <script src="/pattern/assets/js/patternFormManager.js"></script>
    <script src="/pattern/assets/js/availablePatternsManager.js"></script>
    <script src="/pattern/assets/js/main.js"></script>
  </head>
  <body>
    <div class="real-time-indicator" id="real-time-indicator">
      ğŸ”„ Converting...
    </div>
    <div class="container">
      <h1>Pattern Image Converter</h1>

      <div class="form-section">
        <h3>Nháº­p Text cáº§n chuyá»ƒn Ä‘á»•i</h3>
        <div class="text-input">
          <label for="text">Text Input</label>
          <textarea
            id="text"
            name="text"
            rows="2"
            placeholder="Nháº­p ná»™i dung cáº§n chuyá»ƒn Ä‘á»•i (vÃ­ dá»¥: HELLO, 123, ABC)"
            required
          >
<%= data?.text || '' %></textarea
          >
          <div class="hint">
            Chá»‰ há»— trá»£ chá»¯ cÃ¡i A-Z vÃ  sá»‘ 0-9. Káº¿t quáº£ sáº½ hiá»ƒn thá»‹ ngay khi báº¡n
            gÃµ!
          </div>
        </div>
      </div>

      <!-- Result Section (below text input) -->
      <div class="form-section result-section-inline">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
          "
        >
          <h3 style="margin: 0; font-size: 16px">Káº¿t quáº£ chuyá»ƒn Ä‘á»•i</h3>
          <button
            id="exportImageBtn"
            style="
              padding: 8px 16px;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              border: none;
              border-radius: 6px;
              cursor: pointer;
              font-weight: 600;
              font-size: 12px;
              transition: all 0.3s ease;
              box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            "
          >
            ğŸ“¥ Xuáº¥t hÃ¬nh áº£nh
          </button>
        </div>
        <div
          style="
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 10px;
          "
        >
          <div>
            <label
              for="characterSpacingInput"
              style="
                display: block;
                margin-bottom: 6px;
                font-weight: 600;
                color: #333;
              "
            >
              Khoáº£ng cÃ¡ch giá»¯a cÃ¡c kÃ½ tá»±:
              <span
                id="characterSpacingValue"
                style="color: #667eea; font-weight: 700; font-size: 14px"
                >0</span
              >
            </label>
            <input
              type="range"
              id="characterSpacingInput"
              min="0"
              max="200"
              value="0"
              step="1"
              style="
                width: 100%;
                height: 8px;
                cursor: pointer;
                accent-color: #667eea;
              "
            />
            <div
              style="
                display: flex;
                justify-content: space-between;
                margin-top: 5px;
                font-size: 11px;
                color: #999;
              "
            >
              <span>0(sÃ¡t nhau)</span><span>100</span><span>200</span>
            </div>
          </div>
          <div>
            <label
              for="wordSpacingInput"
              style="
                display: block;
                margin-bottom: 6px;
                font-weight: 600;
                color: #333;
              "
            >
              Khoáº£ng cÃ¡ch giá»¯a cÃ¡c tá»«:
              <span
                id="wordSpacingValue"
                style="color: #667eea; font-weight: 700; font-size: 14px"
                >40</span
              >
            </label>
            <input
              type="range"
              id="wordSpacingInput"
              min="0"
              max="200"
              value="20"
              step="1"
              style="
                width: 100%;
                height: 8px;
                cursor: pointer;
                accent-color: #667eea;
              "
            />
            <div
              style="
                display: flex;
                justify-content: space-between;
                margin-top: 5px;
                font-size: 11px;
                color: #999;
              "
            >
              <span>0(sÃ¡t nhau)</span><span>100</span><span>200</span>
            </div>
          </div>
        </div>
        <div
          class="result-images-inline"
          style="max-height: 150px; overflow-y: auto"
        >
          <!-- Results will be populated by JavaScript -->
        </div>
      </div>

      <div class="form-section">
        <h3>Quáº£n lÃ½ Pattern</h3>
        <div style="display: flex; gap: 10px; flex-wrap: wrap">
          <button
            id="openPatternFormBtn"
            style="
              padding: 12px 24px;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              border: none;
              border-radius: 8px;
              cursor: pointer;
              font-weight: 600;
              font-size: 14px;
              transition: all 0.3s ease;
              box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
              flex: 1;
              min-width: 150px;
            "
          >
            â• Táº¡o Pattern má»›i
          </button>
          <button
            id="openAvailablePatternsBtn"
            style="
              padding: 12px 24px;
              background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
              color: white;
              border: none;
              border-radius: 8px;
              cursor: pointer;
              font-weight: 600;
              font-size: 14px;
              transition: all 0.3s ease;
              box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
              flex: 1;
              min-width: 150px;
            "
          >
            ğŸ“š Pattern kháº£ dá»¥ng
          </button>
        </div>
      </div>

      <div class="form-section">
        <div style="display: flex; gap: 30px; flex-wrap: wrap">
          <label
            style="
              display: flex;
              align-items: center;
              gap: 10px;
              cursor: pointer;
            "
          >
            <input
              type="checkbox"
              id="randomMode"
              style="width: 20px; height: 20px; cursor: pointer"
            />
            <span style="font-weight: 600; color: #333">Random</span>
          </label>
          <label
            style="
              display: flex;
              align-items: center;
              gap: 10px;
              cursor: pointer;
            "
          >
            <input
              type="checkbox"
              id="rotateMode"
              style="width: 20px; height: 20px; cursor: pointer"
            />
            <span style="font-weight: 600; color: #333">Rotate</span>
          </label>
        </div>
        <div class="hint" style="margin-top: 10px; margin-bottom: 0">
          <strong>Random:</strong> Má»—i kÃ½ tá»± chá»n ngáº«u nhiÃªn tá»« táº¥t cáº£ bá»™
          pattern. <strong>Rotate:</strong> CÃ¡c kÃ½ tá»± láº§n lÆ°á»£t sá»­ dá»¥ng pattern
          theo thá»© tá»± Ä‘Ã£ sáº¯p xáº¿p.
        </div>
      </div>

      <div class="form-section">
        <h3>Pattern list</h3>
        <div id="patternSetsList"></div>
        <div class="hint">Hold and drag to reorder.</div>
      </div>
      <% if (data && data.error) { %>
      <div class="result-section" style="background: #fee; border-color: #fcc">
        <h3 style="color: #c33">Lá»—i</h3>
        <p><%= data.error %></p>
      </div>
      <% } %>
    </div>

    <!-- Available Patterns Modal -->
    <div class="modal-overlay" id="availablePatternsModal">
      <div class="modal-content" style="max-width: 800px">
        <div class="modal-header">
          <h2>Pattern kháº£ dá»¥ng</h2>
          <button class="modal-close" id="closeAvailablePatternsBtn">
            &times;
          </button>
        </div>
        <div style="padding: 20px; max-height: 70vh; overflow-y: auto">
          <div class="hint" style="margin-bottom: 20px">
            Chá»n cÃ¡c pattern Ä‘á»ƒ thÃªm vÃ o danh sÃ¡ch. Patterns Ä‘Ã£ cÃ³ trong danh
            sÃ¡ch sáº½ Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u.
          </div>
          <div id="availablePatternsList"></div>
        </div>
        <div class="modal-actions">
          <button
            type="button"
            class="modal-btn modal-btn-secondary"
            id="closeAvailablePatternsBtn2"
          >
            ÄÃ³ng
          </button>
        </div>
      </div>
    </div>

    <!-- Pattern Form Modal -->
    <div class="modal-overlay" id="patternFormModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Táº¡o Pattern má»›i</h2>
          <button class="modal-close" id="closePatternFormBtn">&times;</button>
        </div>
        <form id="patternForm">
          <div class="modal-form-group">
            <label for="patternNameInput">TÃªn Pattern:</label>
            <input
              type="text"
              id="patternNameInput"
              placeholder="Nháº­p tÃªn pattern"
              required
            />
          </div>
          <div class="modal-form-group">
            <label>Pattern Ä‘Ã£ lÆ°u</label>
            <div class="pattern-preview" id="patternPreview">
              <div class="pattern-preview-empty">
                ChÆ°a cÃ³ pattern nÃ o Ä‘Ã£ Ä‘Æ°á»£c lÆ°u.
              </div>
            </div>
          </div>
          <div class="modal-form-group">
            <label for="modalUploadImageInput">Chá»n Folder Pattern:</label>
            <input
              type="file"
              id="modalUploadImageInput"
              accept="image/*"
              multiple
              webkitdirectory
              directory
              mozdirectory
              style="margin-bottom: 10px"
            />
            <div
              id="modalUploadStatus"
              class="hint"
              style="margin-top: 10px; display: none"
            ></div>
            <div
              id="modalUploadProgress"
              style="margin-top: 10px; display: none"
            >
              <div
                style="
                  background: #f0f0f0;
                  border-radius: 8px;
                  height: 20px;
                  overflow: hidden;
                  margin-bottom: 5px;
                "
              >
                <div
                  id="modalProgressBar"
                  style="
                    background: linear-gradient(
                      135deg,
                      #667eea 0%,
                      #764ba2 100%
                    );
                    height: 100%;
                    width: 0%;
                    transition: width 0.3s ease;
                  "
                ></div>
              </div>
              <div
                id="modalProgressText"
                style="font-size: 12px; color: #666; text-align: center"
              ></div>
            </div>
          </div>
          <div class="modal-form-group">
            <label>Preview Pattern:</label>
            <div class="pattern-preview" id="uploadPreview">
              <div class="pattern-preview-empty">
                ChÆ°a cÃ³ pattern nÃ o Ä‘Æ°á»£c upload. HÃ£y upload folder pattern Ä‘á»ƒ
                xem preview.
              </div>
            </div>
          </div>
          <div class="modal-actions">
            <button
              type="button"
              class="modal-btn modal-btn-secondary"
              id="cancelPatternFormBtn"
            >
              Há»§y
            </button>
            <button
              type="submit"
              class="modal-btn modal-btn-primary"
              id="savePatternBtn"
            >
              ğŸ’¾ LÆ°u Pattern
            </button>
          </div>
        </form>
      </div>
    </div>
  </body>
</html>
